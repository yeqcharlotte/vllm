# ruff: noqa
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: Copyright contributors to the vLLM project
import os

from vllm import LLM, SamplingParams
from vllm.inputs import TokensPrompt

MODEL_PATH = "/data/users/yeq/checkpoints/gpt-oss-120b"
prompts = [
    TokensPrompt(
        prompt_token_ids=[
            200006,
            17360,
            200008,
            3575,
            553,
            17554,
            162016,
            11,
            261,
            4410,
            6439,
            2359,
            22203,
            656,
            7788,
            17527,
            558,
            87447,
            100594,
            25,
            220,
            1323,
            19,
            12,
            3218,
            198,
            6576,
            3521,
            25,
            220,
            1323,
            20,
            12,
            3114,
            12,
            2922,
            279,
            30377,
            289,
            25,
            14093,
            279,
            2,
            20574,
            279,
            877,
            9282,
            279,
            393,
            67889,
            395,
            72712,
            483,
            261,
            9282,
            11,
            395,
            4994,
            11,
            261,
            91238,
            9282,
            7621,
            350,
            6896,
            53637,
            11,
            3926,
            220,
            16,
            8869,
            8869,
            19176,
            350,
            8673,
            166163,
            11,
            3926,
            220,
            16,
            8869,
            8869,
            446,
            4797,
            9282,
            95359,
            9609,
            290,
            4733,
            328,
            290,
            6348,
            28246,
            432,
            1381,
            448,
            25383,
            62975,
            11264,
            41551,
            538,
            350,
            427,
            1606,
            538,
            8,
            461,
            11854,
            2483,
            6,
            382,
            920,
            558,
            2493,
            25398,
            314,
            11350,
            25,
            405,
            18804,
            25,
            1621,
            72528,
            11854,
            2483,
            8528,
            1621,
            412,
            1596,
            6457,
            8528,
            1621,
            412,
            32264,
            8528,
            2086,
            412,
            6073,
            8528,
            2817,
            412,
            1428,
            8528,
            1621,
            412,
            9263,
            871,
            1062,
            502,
            92,
            602,
            9819,
            9282,
            279,
            2,
            13888,
            18403,
            25,
            8450,
            11,
            1721,
            13,
            21030,
            2804,
            413,
            7360,
            395,
            1753,
            3176,
            13,
            200007,
            200006,
            1428,
            200008,
            976,
            101123,
            5204,
            483,
            42006,
            548,
            88,
            56980,
            42923,
            17,
            40412,
            19,
            3,
            382,
            93819,
            548,
            1910,
            42923,
            59,
            156415,
            61526,
            9446,
            34421,
            7480,
            2846,
            290,
            12839,
            13,
            623,
            5746,
            2438,
            306,
            290,
            19062,
            196051,
            1919,
            290,
            4756,
            101123,
            5204,
            326,
            1617,
            3621,
            64353,
            853,
            548,
            88,
            3,
            12,
            140563,
            126456,
            63757,
            90,
            64,
            66126,
            64991,
            90,
            65,
            6478,
            90,
            66,
            61526,
            11,
            1919,
            548,
            64,
            108989,
            548,
            65,
            108989,
            326,
            548,
            66,
            3,
            553,
            8841,
            54912,
            11,
            326,
            548,
            64,
            3,
            326,
            548,
            66,
            3,
            553,
            19919,
            9197,
            13,
            9764,
            548,
            64,
            76609,
            114860,
            3,
            558,
            8256,
            5207,
            5983,
            656,
            5983,
            11,
            326,
            3006,
            634,
            1721,
            6052,
            3518,
            2381,
            172278,
            108872,
            200007,
            200006,
            173781,
            200005,
            35644,
            200008,
            2167,
            679,
            4756,
            101123,
            5204,
            25,
            342,
            314,
            1215,
            61,
            17,
            533,
            19,
            13,
            98562,
            290,
            27636,
            656,
            220,
            1910,
            6793,
            21547,
            54,
            1078,
            12839,
            13,
            19792,
            42002,
            5571,
            2870,
            4756,
            326,
            93819,
            27636,
            13,
            9764,
            2438,
            1858,
            8,
            306,
            19062,
            196051,
            350,
            87,
            29,
            15,
            30,
            69552,
            196051,
            25,
            1215,
            29,
            15,
            11,
            342,
            27,
            15,
            741,
            42417,
            2238,
            2438,
            364,
            2167,
            1309,
            316,
            1646,
            342,
            195003,
            22171,
            472,
            350,
            64,
            533,
            44237,
            3229,
            74514,
            66,
            13,
            45438,
            261,
            76609,
            114860,
            364,
            24507,
            678,
            25,
            34617,
            23769,
            26242,
            25,
            350,
            87,
            25,
            22257,
            350,
            87,
            11,
            342,
            8784,
            20416,
            780,
            2438,
            382,
            350,
            87,
            787,
            342,
            1542,
            1919,
            350,
            87,
            787,
            342,
            1542,
            314,
            460,
            350,
            87,
            11,
            342,
            8,
            483,
            23769,
            12248,
            656,
            16538,
            12962,
            314,
            220,
            1910,
            6793,
            25,
            460,
            314,
            9237,
            10732,
            4114,
            11,
            533,
            23516,
            4114,
            2155,
            723,
            23516,
            4114,
            11,
            8974,
            4114,
            8928,
            364,
            2167,
            1309,
            5571,
            350,
            87,
            11,
            342,
            8,
            484,
            7149,
            402,
            2973,
            4756,
            101123,
            5204,
            326,
            402,
            290,
            93819,
            3621,
            328,
            290,
            101123,
            5204,
            13,
            125152,
            1354,
            13031,
            1236,
            2438,
            350,
            84,
            11,
            323,
            8,
            402,
            4756,
            101123,
            5204,
            2238,
            484,
            1934,
            23769,
            581,
            717,
            350,
            87,
            11,
            342,
            8,
            314,
            460,
            350,
            84,
            11,
            323,
            741,
            3072,
            581,
            1217,
            1309,
            350,
            87,
            11,
            342,
            8,
            35441,
            4756,
            42006,
            342,
            314,
            1215,
            61,
            17,
            533,
            19,
            364,
            3387,
            4552,
            3874,
            11,
            1354,
            13031,
            350,
            84,
            11,
            323,
            8,
            2238,
            484,
            323,
            314,
            337,
            61,
            17,
            533,
            220,
            19,
            11,
            326,
            350,
            87,
            11,
            342,
            8,
            314,
            350,
            84,
            8974,
            4114,
            533,
            323,
            2187,
            4114,
            11,
            337,
            2187,
            4114,
            659,
            323,
            8974,
            4114,
            8,
            126205,
            342,
            314,
            1215,
            61,
            17,
            533,
            19,
            364,
            2167,
            1309,
            9368,
            350,
            87,
            16103,
            8,
            483,
            1215,
            29,
            15,
            11,
            342,
            27,
            15,
            364,
            2167,
            665,
            17722,
            61524,
            364,
            12845,
            802,
            175342,
            274,
            314,
            8974,
            1910,
            314,
            220,
            16,
            14,
            17,
            11,
            265,
            314,
            2187,
            1910,
            314,
            143029,
            18,
            14,
            17,
            364,
            5808,
            61524,
            1402,
            87,
            314,
            337,
            274,
            533,
            323,
            265,
            314,
            350,
            16,
            14,
            17,
            8,
            337,
            533,
            350,
            103946,
            18,
            14,
            17,
            8,
            323,
            198,
            88,
            314,
            337,
            265,
            659,
            323,
            274,
            314,
            350,
            103946,
            18,
            14,
            17,
            8,
            337,
            659,
            350,
            16,
            14,
            17,
            8,
            323,
            279,
            2886,
            44762,
            323,
            314,
            337,
            61,
            17,
            533,
            19,
            364,
            97401,
            1511,
            342,
            314,
            1215,
            61,
            17,
            533,
            19,
            364,
            2167,
            679,
            17927,
            337,
            13,
            7801,
            23864,
            1215,
            16103,
            364,
            12845,
            802,
            17722,
            80925,
            2905,
            364,
            2167,
            679,
            1215,
            314,
            350,
            16,
            14,
            17,
            8,
            84,
            533,
            350,
            103946,
            18,
            14,
            17,
            139834,
            314,
            350,
            16,
            14,
            17,
            8,
            84,
            533,
            350,
            103946,
            18,
            14,
            17,
            4898,
            84,
            61,
            17,
            533,
            19,
            446,
            4715,
            1215,
            314,
            350,
            16,
            14,
            17,
            8,
            84,
            533,
            350,
            103946,
            18,
            14,
            17,
            8,
            84,
            61,
            17,
            659,
            220,
            17,
            103946,
            18,
            279,
            19048,
            533,
            350,
            103946,
            18,
            14,
            17,
            4898,
            12,
            19,
            8,
            314,
            659,
            17,
            103946,
            18,
            13,
            9700,
            364,
            151907,
            342,
            314,
            350,
            103946,
            18,
            14,
            17,
            8,
            84,
            659,
            350,
            16,
            14,
            17,
            139834,
            314,
            350,
            103946,
            18,
            14,
            17,
            8,
            84,
            659,
            350,
            16,
            14,
            17,
            4898,
            84,
            61,
            17,
            533,
            19,
            446,
            4715,
            342,
            314,
            350,
            103946,
            18,
            14,
            17,
            8,
            84,
            659,
            350,
            16,
            14,
            17,
            8,
            84,
            61,
            17,
            533,
            17,
            279,
            10620,
            68003,
            342,
            314,
            1215,
            61,
            17,
            533,
            19,
            364,
            56734,
            1215,
            61,
            17,
            25,
            581,
            1340,
            13749,
            12973,
            364,
            58369,
            1199,
            70648,
            80925,
            4493,
            22752,
            5357,
            5823,
            13,
            200007,
            200006,
            173781,
            316,
            28,
            6896,
            38155,
            200005,
            35644,
            220,
            200003,
            4108,
            200008,
            10848,
            18804,
            1243,
            9129,
            103423,
            672,
            12746,
            33755,
            672,
            392,
            29010,
            18,
            533,
            2256,
            461,
            64719,
            36853,
            77,
            561,
            5357,
            5823,
            472,
            1014,
            3392,
            84,
            28,
            1148,
            70386,
            82,
            706,
            84,
            787,
            1374,
            7827,
            23428,
            6097,
            17629,
            18,
            28,
            1148,
            38011,
            7,
            18,
            23428,
            45103,
            314,
            1014,
            3395,
            1953,
            7,
            16,
            11,
            17,
            11043,
            84,
            533,
            44237,
            18,
            14,
            17,
            156006,
            410,
            17,
            659,
            220,
            17,
            9,
            64991,
            18,
            59,
            3008,
            314,
            44237,
            18,
            14,
            17,
            156006,
            659,
            1014,
            3395,
            1953,
            7,
            16,
            11,
            17,
            11043,
            84,
            410,
            17,
            533,
            220,
            17,
            3392,
            21343,
            314,
            1014,
            640,
            10766,
            1985,
            14684,
            533,
            350,
            87,
            410,
            17,
            533,
            220,
            19,
            915,
            59,
            77,
            1598,
            33591,
            61449,
            78746,
            915,
            59,
            77,
            64719,
            2601,
            92,
            200012,
            200006,
            6896,
            38155,
            316,
            28,
            173781,
            200005,
            35644,
            200008,
            12,
            18,
            156006,
            410,
            19,
            14,
            19,
            659,
            44237,
            7,
            18,
            11043,
            84,
            410,
            18,
            14,
            17,
            659,
            220,
            1161,
            156006,
            410,
            17,
            14,
            19,
            533,
            220,
            18,
            9,
            64991,
            7,
            18,
            11043,
            84,
            14,
            17,
            533,
            220,
            702,
            198,
            200007,
            200006,
            173781,
            200005,
            35644,
            200008,
            129214,
            25,
            533,
            18,
            14,
            19,
            337,
            61,
            19,
            659,
            350,
            64991,
            18,
            11876,
            17,
            337,
            61,
            18,
            659,
            220,
            1161,
            14,
            19,
            337,
            61,
            17,
            533,
            350,
            18,
            44237,
            18,
            11876,
            17,
            337,
            533,
            702,
            314,
            15,
            13,
            137658,
            656,
            220,
            19,
            316,
            8397,
            110523,
            1402,
            12,
            18,
            337,
            61,
            19,
            659,
            220,
            17,
            44237,
            18,
            337,
            61,
            18,
            659,
            220,
            1161,
            337,
            61,
            17,
            533,
            220,
            21,
            44237,
            18,
            337,
            533,
            1723,
            314,
            15,
            279,
            113552,
            656,
            533,
            16,
            25,
            220,
            18,
            337,
            61,
            19,
            533,
            220,
            17,
            44237,
            18,
            337,
            61,
            18,
            533,
            1161,
            337,
            61,
            17,
            659,
            220,
            21,
            44237,
            18,
            337,
            659,
            220,
            1723,
            314,
            15,
            364,
            5808,
            113464,
            328,
            9882,
            220,
            19,
            483,
            44237,
            18,
            76338,
            13,
            1416,
            665,
            2075,
            316,
            12332,
            1511,
            39966,
            55687,
            12951,
            483,
            43286,
            76338,
            30,
            138743,
            4665,
            472,
            113464,
            306,
            337,
            483,
            76338,
            306,
            1486,
            1858,
            17629,
            18,
            741,
            30456,
            12332,
            472,
            350,
            753,
            61,
            17,
            659,
            1188,
            659,
            274,
            4898,
            698,
            61,
            17,
            659,
            5658,
            659,
            285,
            741,
            41021,
            2075,
            2360,
            5357,
            5823,
            139906,
            13,
            200007,
            200006,
            173781,
            316,
            28,
            6896,
            38155,
            200005,
            35644,
            220,
            200003,
            4108,
            200008,
            10848,
            18804,
            1243,
            9129,
            103423,
            672,
            12746,
            33755,
            672,
            392,
            29010,
            18,
            533,
            2256,
            461,
            64719,
            36853,
            77,
            561,
            5357,
            5823,
            472,
            1014,
            3392,
            84,
            28,
            1148,
            70386,
            82,
            706,
            84,
            1542,
            59,
            77,
            21343,
            28,
            18,
            156006,
            410,
            19,
            533,
            220,
            17,
            9,
            1148,
            38011,
            7,
            18,
            11043,
            84,
            410,
            18,
            533,
            1161,
            156006,
            410,
            17,
            659,
            220,
            21,
            9,
            1148,
            38011,
            7,
            18,
            11043,
            84,
            659,
            220,
            1723,
            3392,
            1598,
            33591,
            196244,
            78746,
            915,
            59,
            77,
            64719,
            2601,
            92,
            200012,
            200006,
            6896,
            38155,
            316,
            28,
            173781,
            200005,
            35644,
            200008,
            18,
            156006,
            410,
            19,
            533,
            220,
            17,
            9,
            64991,
            7,
            18,
            11043,
            84,
            410,
            18,
            533,
            220,
            1161,
            156006,
            410,
            17,
            659,
            220,
            21,
            9,
            64991,
            7,
            18,
            11043,
            84,
            659,
            220,
            1723,
            198,
            200007,
            200006,
            173781,
            200005,
            35644,
            200008,
            35578,
            5823,
            9289,
            12332,
            14188,
            13,
            41021,
            2075,
            139906,
            1072,
            15369,
            44237,
            18,
            13,
            7649,
            12332,
            483,
            15369,
            13,
            200007,
            200006,
        ]
    )
]
sampling_params = SamplingParams(temperature=1, max_tokens=16)

os.environ["TIKTOKEN_RS_CACHE_DIR"] = MODEL_PATH
os.environ["FLASHINFER_WORKSPACE_BASE"] = "/tmp"
os.environ["VLLM_USE_FLASHINFER_SAMPLER"] = "1"
os.environ["VLLM_DISABLE_COMPILE_CACHE"] = "1"
os.environ["VLLM_GPU_MEMORY_UTILIZATION"] = "0.8"
os.environ["VLLM_USE_FLASHINFER_MOE_MXFP4_BF16"] = "1"
os.environ["TORCH_CUDA_ARCH_LIST"] = "10.0a"


def run_triton():
    print("Running with Triton:")
    os.environ["VLLM_USE_TRTLLM_ATTENTION"] = "0"
    os.environ["VLLM_USE_TRTLLM_DECODE_ATTENTION"] = "0"
    os.environ["VLLM_USE_TRTLLM_CONTEXT_ATTENTION"] = "0"
    os.environ["VLLM_ATTENTION_BACKEND"] = "TRITON_ATTN_VLLM_V1"
    run_once()


def run_trtllm():
    print("Running with TrtLLM:")
    os.environ["VLLM_USE_TRTLLM_ATTENTION"] = "1"
    os.environ["VLLM_USE_TRTLLM_DECODE_ATTENTION"] = "1"
    os.environ["VLLM_USE_TRTLLM_CONTEXT_ATTENTION"] = "1"
    os.environ.pop("VLLM_ATTENTION_BACKEND", None)
    run_once()


def run_once():
    llm = LLM(model=MODEL_PATH)
    outputs = llm.generate(prompts, sampling_params)
    # Print the outputs.
    print("\nGenerated Outputs:\n" + "-" * 60)
    for output in outputs:
        generated_text = output.outputs[0].text
        print(f"Output:    {generated_text!r}")
        print("-" * 60)


if __name__ == "__main__":
    run_triton()
    run_trtllm()
